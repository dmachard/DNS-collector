# DNS-collector - Configuration Guide

The configuration of DNS-collector is done through one yaml file named [`config.yml`](https://github.com/dmachard/go-dnscollector/blob/main/config.yml). When the DNS-collector starts, it will look for the config.yml from the current working directory.

A typically [configuration in pipeline](./running_mode.md) mode would have one or more collector to receive DNS traffic, and severals loggers to process the incoming traffics.  You can take a look to the list of config [`full examples`](examples.md).

You can find the global settings below

- [Trace](#trace)
- [Server identity](#server-identity)
- [Pid file](#pid-file)
- [Telemetry](#telemetry)

## Trace

Logs can be enable to have more informations like debug, errors messages generated by the application

Options:

- `verbose`: (boolean) debug informations, if turned on, log some applications messages
- `filename`: (string) filename is the file to write logs to.
- `max-size`: (integer) maximum size in megabytes of the log file it gets rotated
- `max-backups`: (integer) maximum number of old log files to retain
- `log-malformed`: (boolean) log malformed packet

```yaml
global:
  trace:
    verbose: true
    log-malformed: false
    filename: ""
    max-size: 10
    max-backups: 10
```

Example:

```bash
INFO: 2022/06/25 20:54:18.173239 main - version 0.0.0
INFO: 2022/06/25 20:54:18.173271 main - config loaded...
INFO: 2022/06/25 20:54:18.173277 main - starting dns-collector...
....
INFO: 2022/06/25 20:54:18.174256 [dtap] dnstap collector - running in background...
INFO: 2022/06/25 20:54:18.174286 [dtap] dnstap collector - is listening on [::]:6000
```

## Server Identity

Set the server identity name. The hostname will be used if empty

```yaml
global:
  server-identity: "dns-collector"
```

## Worker

The `interval-monitor` in second(s) is used to count every XX second the number of in/out packets.

The `buffer-size` settings enable to adjust the size of the buffer before discard additional packets. If you encounter the warning message buffer is full, xxx packet(s) dropped, consider increasing this parameter to prevent message drops.
  
```yaml
global:
  worker:
    interval-monitor: 10
    buffer-size: 8192
```

## Pid file

Set path to create DNS-collector PID.
By default, this settings is empty.

```yaml
global:
  pid-file: "/path/to/your/pidfile.pid"
```

## Telemetry

Enable and configure telemetry

```yaml
global:
  telemetry:
    enabled: false
    web-path: "/metrics"
    web-listen: ":9165"
    prometheus-prefix: "dnscollector_exporter"
    tls-support: false
    tls-cert-file: ""
    tls-key-file: ""
    client-ca-file: ""
    basic-auth-enable: false
    basic-auth-login: admin
    basic-auth-pwd: changeme
```
